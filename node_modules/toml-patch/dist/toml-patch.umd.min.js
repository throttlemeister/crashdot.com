!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).TOML={})}(this,function(e){"use strict";var t,n;function l(e){return e.type===t.Document}function o(e){return e.type===t.Table}function r(e){return e.type===t.TableArray}function a(e){return e.type===t.KeyValue}function c(e){return e.type===t.InlineArray}function i(e){return e.type===t.InlineItem}function u(e){return e.type===t.InlineTable}function s(e){return e.type===t.Comment}function f(e){return l(e)||o(e)||r(e)||u(e)||c(e)}function m(e){return function(e){return e.type===t.TableKey}(e)||function(e){return e.type===t.TableArrayKey}(e)||i(e)}!function(e){e.Document="Document",e.Table="Table",e.TableKey="TableKey",e.TableArray="TableArray",e.TableArrayKey="TableArrayKey",e.KeyValue="KeyValue",e.Key="Key",e.String="String",e.Integer="Integer",e.Float="Float",e.Boolean="Boolean",e.DateTime="DateTime",e.InlineArray="InlineArray",e.InlineItem="InlineItem",e.InlineTable="InlineTable",e.Comment="Comment"}(t||(t={}));class d{constructor(e){this.iterator=e,this.index=-1,this.value=void 0,this.done=!1,this.peeked=null}next(){if(this.done)return y();const e=this.peeked||this.iterator.next();return this.index+=1,this.value=e.value,this.done=e.done,this.peeked=null,e}peek(){return this.done?y():this.peeked?this.peeked:(this.peeked=this.iterator.next(),this.peeked)}[Symbol.iterator](){return this}}function y(){return{value:void 0,done:!0}}function p(e){return{lines:e.end.line-e.start.line+1,columns:e.end.column-e.start.column}}function v(e,t){const n=Array.isArray(e)?e:w(e),l=n.findIndex(e=>e>=t)+1;return{line:l,column:t-(n[l-2]+1||0)}}function w(e){const t=/[\r\n|\n]/g,n=[];let l;for(;null!=(l=t.exec(e));)n.push(l.index);return n.push(e.length+1),n}function h(e){return{line:e.line,column:e.column}}function g(e){return{start:h(e.start),end:h(e.end)}}class b extends Error{constructor(e,t,n){let l=`Error parsing TOML (${t.line}, ${t.column+1}):\n`;if(e){const n=function(e,t){const n=w(e),l=n[t.line-2]||0,o=n[t.line-1]||e.length;return e.substr(l,o-l)}(e,t),o=`${function(e,t=" "){return t.repeat(e)}(t.column)}^`;n&&(l+=`${n}\n${o}\n`)}super(l+=n),this.line=t.line,this.column=t.column}}!function(e){e.Bracket="Bracket",e.Curly="Curly",e.Equal="Equal",e.Comma="Comma",e.Dot="Dot",e.Comment="Comment",e.Literal="Literal"}(n||(n={}));const k=/\s/,x=/(\r\n|\n)/,T='"',I="'",A=" ",E="\\",$=/[\w,\d,\",\',\+,\-,\_]/;function*S(e){const t=new d(e[Symbol.iterator]());t.next();const l=function(e){const t=w(e);return(e,n)=>({start:v(t,e),end:v(t,n)})}(e);for(;!t.done;){if(k.test(t.value));else if("["===t.value||"]"===t.value)yield K(t,l,n.Bracket);else if("{"===t.value||"}"===t.value)yield K(t,l,n.Curly);else if("="===t.value)yield K(t,l,n.Equal);else if(","===t.value)yield K(t,l,n.Comma);else if("."===t.value)yield K(t,l,n.Dot);else if("#"===t.value)yield C(t,l);else{const n=j(e,t.index,I)||j(e,t.index,T);n?yield O(t,l,n,e):yield D(t,l,e)}t.next()}}function K(e,t,n){return{type:n,raw:e.value,loc:t(e.index,e.index+1)}}function C(e,t){const l=e.index;let o=e.value;for(;!e.peek().done&&!x.test(e.peek().value);)e.next(),o+=e.value;return{type:n.Comment,raw:o,loc:t(l,e.index+1)}}function O(e,t,l,o){const r=e.index;let a=l+l+l,c=a;for(e.next(),e.next(),e.next();!e.done&&!j(o,e.index,l);)c+=e.value,e.next();if(e.done)throw new b(o,v(o,e.index),`Expected close of multiline string with ${a}, reached end of file`);return c+=a,e.next(),e.next(),{type:n.Literal,raw:c,loc:t(r,e.index+1)}}function D(e,t,l){if(!$.test(e.value))throw new b(l,v(l,e.index),`Unsupported character "${e.value}". Expected ALPHANUMERIC, ", ', +, -, or _`);const o=e.index;let r=e.value,a=e.value===T,c=e.value===I;const i=e=>{if(e.peek().done)return!0;const t=e.peek().value;return!(a||c)&&(k.test(t)||","===t||"."===t||"]"===t||"}"===t||"="===t)};for(;!e.done&&!i(e)&&(e.next(),e.value===T&&(a=!a),e.value!==I||a||(c=!c),r+=e.value,!e.peek().done);){let t=e.peek().value;a&&e.value===E&&(t===T?(r+=T,e.next()):t===E&&(r+=E,e.next()))}if(a||c)throw new b(l,v(l,o),`Expected close of string with ${a?T:I}`);return{type:n.Literal,raw:r,loc:t(o,e.index+1)}}function j(e,t,n){return e[t]===n&&e[t+1]===n&&e[t+2]===n&&n}function B(e){return e[e.length-1]}function _(){return Object.create(null)}function F(e){return"number"==typeof e&&e%1==0}function M(e){return"[object Date]"===Object.prototype.toString.call(e)}function N(e){return e&&"object"==typeof e&&!M(e)&&!Array.isArray(e)}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function U(e,...t){return t.reduce((e,t)=>t(e),e)}function V(e){if(N(e)){return`{${Object.keys(e).sort().map(t=>`${JSON.stringify(t)}:${V(e[t])}`).join(",")}}`}return Array.isArray(e)?`[${e.map(V).join(",")}]`:JSON.stringify(e)}function q(e,t){const n=e.length,l=t.length;e.length=n+l;for(let o=0;o<l;o++)e[n+o]=t[o]}const R='"""',W="'''",J="\\n",P="\\r\\n",z=/\r\n/g,H=/\n/g,G=/^(\r\n|\n)/,Q=/\\\s*[\n\r\n]\s*/g;function X(e){return e.startsWith(W)?U(Z(e,3),ee):e.startsWith(I)?Z(e,1):e.startsWith(R)?U(Z(e,3),ee,ne,te,Y):e.startsWith(T)?U(Z(e,1),Y):e}function Y(e){const t=e.replace(/\\U[a-fA-F0-9]{8}/g,e=>{const t=parseInt(e.replace("\\U",""),16),n=String.fromCodePoint(t);return Z(JSON.stringify(n),1)});return JSON.parse(`"${t}"`)}function Z(e,t){return e.substr(t,e.length-2*t)}function ee(e){return G.test(e)?e.substr(1):e}function te(e){return e.replace(z,P).replace(H,J)}function ne(e){return e.replace(Q,"")}const le="true",oe="false",re=/e/i,ae=/\_/g,ce=/inf/,ie=/nan/,ue=/^0x/,se=/^0o/,fe=/^0b/,me=/(\d{4})-(\d{2})-(\d{2})/,de=/(\d{2}):(\d{2}):(\d{2})/;function*ye(e){const t=S(e),n=new d(t);for(;!n.next().done;)yield*pe(n,e)}function*pe(e,l){if(e.value.type===n.Comment)yield we(e);else if(e.value.type===n.Bracket)yield function(e,l){const o=e.peek().done||e.peek().value.type!==n.Bracket?t.Table:t.TableArray,r=o===t.Table;if(r&&"["!==e.value.raw)throw new b(l,e.value.loc.start,`Expected table opening "[", found ${e.value.raw}`);if(!r&&("["!==e.value.raw||"["!==e.peek().value.raw))throw new b(l,e.value.loc.start,`Expected array of tables opening "[[", found ${e.value.raw+e.peek().value.raw}`);const a=r?{type:t.TableKey,loc:e.value.loc}:{type:t.TableArrayKey,loc:e.value.loc};e.next(),o===t.TableArray&&e.next();if(e.done)throw new b(l,a.loc.start,"Expected table key, reached end of file");a.item={type:t.Key,loc:g(e.value.loc),raw:e.value.raw,value:[X(e.value.raw)]};for(;!e.peek().done&&e.peek().value.type===n.Dot;){e.next();const t=e.value;e.next();const n=" ".repeat(t.loc.start.column-a.item.loc.end.column),l=" ".repeat(e.value.loc.start.column-t.loc.end.column);a.item.loc.end=e.value.loc.end,a.item.raw+=`${n}.${l}${e.value.raw}`,a.item.value.push(X(e.value.raw))}if(e.next(),r&&(e.done||"]"!==e.value.raw))throw new b(l,e.done?a.item.loc.end:e.value.loc.start,`Expected table closing "]", found ${e.done?"end of file":e.value.raw}`);if(!r&&(e.done||e.peek().done||"]"!==e.value.raw||"]"!==e.peek().value.raw))throw new b(l,e.done||e.peek().done?a.item.loc.end:e.value.loc.start,`Expected array of tables closing "]]", found ${e.done||e.peek().done?"end of file":e.value.raw+e.peek().value.raw}`);r||e.next();a.loc.end=e.value.loc.end;let c=[];for(;!e.peek().done&&e.peek().value.type!==n.Bracket;)e.next(),q(c,[...pe(e,l)]);return{type:r?t.Table:t.TableArray,loc:{start:h(a.loc.start),end:h(c.length?c[c.length-1].loc.end:a.loc.end)},key:a,items:c}}(e,l);else{if(e.value.type!==n.Literal)throw new b(l,e.value.loc.start,`Unexpected token "${e.value.type}". Expected Comment, Bracket, or String`);yield*function(e,l){const o={type:t.Key,loc:g(e.value.loc),raw:e.value.raw,value:[X(e.value.raw)]};for(;!e.peek().done&&e.peek().value.type===n.Dot;)e.next(),e.next(),o.loc.end=e.value.loc.end,o.raw+=`.${e.value.raw}`,o.value.push(X(e.value.raw));if(e.next(),e.done||e.value.type!==n.Equal)throw new b(l,e.done?o.loc.end:e.value.loc.start,`Expected "=" for key-value, found ${e.done?"end of file":e.value.raw}`);const r=e.value.loc.start.column;if(e.next(),e.done)throw new b(l,o.loc.start,"Expected value for key-value, reached end of file");const[a,...c]=ve(e,l);return[{type:t.KeyValue,key:o,value:a,loc:{start:h(o.loc.start),end:h(a.loc.end)},equals:r},...c]}(e,l)}}function*ve(e,l){if(e.value.type===n.Literal)e.value.raw[0]===T||e.value.raw[0]===I?yield function(e){return{type:t.String,loc:e.value.loc,raw:e.value.raw,value:X(e.value.raw)}}(e):e.value.raw===le||e.value.raw===oe?yield function(e){return{type:t.Boolean,loc:e.value.loc,value:e.value.raw===le}}(e):me.test(e.value.raw)||de.test(e.value.raw)?yield function(e,l){let o,r=e.value.loc,a=e.value.raw;if(!e.peek().done&&e.peek().value.type===n.Literal&&me.test(a)&&de.test(e.peek().value.raw)){const t=r.start;e.next(),r={start:t,end:e.value.loc.end},a+=` ${e.value.raw}`}if(!e.peek().done&&e.peek().value.type===n.Dot){const t=r.start;if(e.next(),e.peek().done||e.peek().value.type!==n.Literal)throw new b(l,e.value.loc.end,"Expected fractional value for DateTime");e.next(),r={start:t,end:e.value.loc.end},a+=`.${e.value.raw}`}if(me.test(a))o=new Date(a.replace(" ","T"));else{const[e]=(new Date).toISOString().split("T");o=new Date(`${e}T${a}`)}return{type:t.DateTime,loc:r,raw:a,value:o}}(e,l):!e.peek().done&&e.peek().value.type===n.Dot||ce.test(e.value.raw)||ie.test(e.value.raw)||re.test(e.value.raw)&&!ue.test(e.value.raw)?yield function(e,l){let o,r=e.value.loc,a=e.value.raw;if(ce.test(a))o="-inf"===a?-1/0:1/0;else if(ie.test(a))o=NaN;else if(e.peek().done||e.peek().value.type!==n.Dot)o=Number(a.replace(ae,""));else{const t=r.start;if(e.next(),e.peek().done||e.peek().value.type!==n.Literal)throw new b(l,e.value.loc.end,"Expected fraction value for Float");e.next(),a+=`.${e.value.raw}`,r={start:t,end:e.value.loc.end},o=Number(a.replace(ae,""))}return{type:t.Float,loc:r,raw:a,value:o}}(e,l):yield function(e){if("-0"===e.value.raw||"+0"===e.value.raw)return{type:t.Integer,loc:e.value.loc,raw:e.value.raw,value:0};let n=10;ue.test(e.value.raw)?n=16:se.test(e.value.raw)?n=8:fe.test(e.value.raw)&&(n=2);const l=parseInt(e.value.raw.replace(ae,"").replace(se,"").replace(fe,""),n);return{type:t.Integer,loc:e.value.loc,raw:e.value.raw,value:l}}(e);else if(e.value.type===n.Curly)yield function(e,l){if("{"!==e.value.raw)throw new b(l,e.value.loc.start,`Expected "{" for inline table, found ${e.value.raw}`);const o={type:t.InlineTable,loc:g(e.value.loc),items:[]};e.next();for(;!e.done&&(e.value.type!==n.Curly||"}"!==e.value.raw);){if(e.value.type===n.Comma){const t=o.items[o.items.length-1];if(!t)throw new b(l,e.value.loc.start,'Found "," without previous value in inline table');t.comma=!0,t.loc.end=e.value.loc.start,e.next();continue}const[r]=pe(e,l);if(r.type!==t.KeyValue)throw new b(l,e.value.loc.start,`Only key-values are supported in inline tables, found ${r.type}`);const a={type:t.InlineItem,loc:g(r.loc),item:r,comma:!1};o.items.push(a),e.next()}if(e.done||e.value.type!==n.Curly||"}"!==e.value.raw)throw new b(l,e.done?o.loc.start:e.value.loc.start,`Expected "}", found ${e.done?"end of file":e.value.raw}`);return o.loc.end=e.value.loc.end,o}(e,l);else{if(e.value.type!==n.Bracket)throw new b(l,e.value.loc.start,`Unrecognized token type "${e.value.type}". Expected String, Curly, or Bracket`);{const[o,r]=function(e,l){if("["!==e.value.raw)throw new b(l,e.value.loc.start,`Expected "[" for inline array, found ${e.value.raw}`);const o={type:t.InlineArray,loc:g(e.value.loc),items:[]};let r=[];e.next();for(;!e.done&&(e.value.type!==n.Bracket||"]"!==e.value.raw);){if(e.value.type===n.Comma){const t=o.items[o.items.length-1];if(!t)throw new b(l,e.value.loc.start,'Found "," without previous value for inline array');t.comma=!0,t.loc.end=e.value.loc.start}else if(e.value.type===n.Comment)r.push(we(e));else{const[n,...a]=ve(e,l),c={type:t.InlineItem,loc:g(n.loc),item:n,comma:!1};o.items.push(c),q(r,a)}e.next()}if(e.done||e.value.type!==n.Bracket||"]"!==e.value.raw)throw new b(l,e.done?o.loc.start:e.value.loc.start,`Expected "]", found ${e.done?"end of file":e.value.raw}`);return o.loc.end=e.value.loc.end,[o,r]}(e,l);yield o,yield*r}}}function we(e){return{type:t.Comment,loc:e.value.loc,raw:e.value.raw}}function he(e,n){var l;function o(e,t){for(const n of e)r(n,t)}function r(e,l){const a=n[e.type];switch(a&&"function"==typeof a&&a(e,l),a&&a.enter&&a.enter(e,l),e.type){case t.Document:o(e.items,e);break;case t.Table:r(e.key,e),o(e.items,e);break;case t.TableKey:r(e.item,e);break;case t.TableArray:r(e.key,e),o(e.items,e);break;case t.TableArrayKey:r(e.item,e);break;case t.KeyValue:r(e.key,e),r(e.value,e);break;case t.InlineArray:o(e.items,e);break;case t.InlineItem:r(e.item,e);break;case t.InlineTable:o(e.items,e);break;case t.Key:case t.String:case t.Integer:case t.Float:case t.Boolean:case t.DateTime:case t.Comment:break;default:throw new Error(`Unrecognized node type "${e.type}"`)}a&&a.exit&&a.exit(e,l)}null!=(l=e)&&"function"==typeof l[Symbol.iterator]?o(e,null):r(e,null)}const ge=new WeakMap,be=e=>(ge.has(e)||ge.set(e,new WeakMap),ge.get(e)),ke=new WeakMap,xe=e=>(ke.has(e)||ke.set(e,new WeakMap),ke.get(e));function Te(e,t,n,l){if(f(t)){const e=t.items.indexOf(n);if(e<0)throw new Error("Could not find existing item in parent node for replace");t.items.splice(e,1,l)}else if(m(t))t.item=l;else{if(!a(t))throw new Error(`Unsupported parent type "${t.type}" for replace`);t.key===n?t.key=l:t.value=l}Ke(l,{lines:n.loc.start.line-l.loc.start.line,columns:n.loc.start.column-l.loc.start.column});const o=p(n.loc),r=p(l.loc);Ce({lines:r.lines-o.lines,columns:r.columns-o.columns},xe(e),l,n)}function Ie(e,t,n,m){if(!f(t))throw new Error(`Unsupported parent type "${t.type}" for insert`);let d,y;m=null!=m?m:t.items.length,c(t)||u(t)?({shift:d,offset:y}=function(e,t,n){if(!i(t))throw new Error(`Incompatible child type "${t.type}"`);const l=null!=n?e.items[n-1]:B(e.items),o=null==n||n===e.items.length;e.items.splice(n,0,t);const r=!!l,a=!o,u=o&&!0===t.comma;r&&(l.comma=!0);a&&(t.comma=!0);const f=c(e)&&function(e){if(!e.items.length)return!1;return p(e.loc).lines>e.items.length}(e),m=l?{line:l.loc.end.line,column:f?s(l)?e.loc.start.column:l.loc.start.column:l.loc.end.column}:h(e.loc.start);let d=0;if(f)d=1;else{const e=2,t=1;m.column+=r?e:t}m.line+=d;const y={lines:m.line-t.loc.start.line,columns:m.column-t.loc.start.column},v=p(t.loc),w={lines:v.lines+(d-1),columns:v.columns+(r||a?2:0)+(u?1:0)};return{shift:y,offset:w}}(t,n,m)):({shift:d,offset:y}=function(e,t,n){if(c=t,!(a(c)||o(c)||r(c)||s(c)))throw new Error(`Incompatible child type "${t.type}"`);var c;const i=e.items[n-1],u=l(e)&&!e.items.length;e.items.splice(n,0,t);const f=i?{line:i.loc.end.line,column:s(i)?e.loc.start.column:i.loc.start.column}:h(e.loc.start),m=o(t)||r(t);let d=0;u||(d=m?2:1);f.line+=d;const y={lines:f.line-t.loc.start.line,columns:f.column-t.loc.start.column},v=p(t.loc),w={lines:v.lines+(d-1),columns:v.columns};return{shift:y,offset:w}}(t,n,m)),Ke(n,d);const v=t.items[m-1],w=v&&xe(e).get(v);w&&(y.lines+=w.lines,y.columns+=w.columns,i(n)&&v&&t.items[m+1]&&(y.columns-=2),xe(e).delete(v)),xe(e).set(n,y)}function Ae(e,t,n){if(!f(t))throw new Error(`Unsupported parent type "${t.type}" for remove`);let l=t.items.indexOf(n);if(l<0){if((l=t.items.findIndex(e=>m(e)&&e.item===n))<0)throw new Error("Could not find node in parent for removal");n=t.items[l]}const o=t.items[l-1];let r=t.items[l+1];t.items.splice(l,1);let a=p(n.loc);r&&s(r)&&r.loc.start.line===n.loc.end.line&&(a=p({start:n.loc.start,end:r.loc.end}),r=t.items[l+1],t.items.splice(l,1));const c=o&&i(o),u=o&&o.loc.end.line===n.loc.start.line,d=r&&r.loc.start.line===n.loc.end.line,y=c&&(u||d),v={lines:-(a.lines-(y?1:0)),columns:-a.columns};c&&u&&(v.columns-=2),c&&o&&!r&&(o.comma=!1);const w=o||t,h=o?xe(e):be(e),g=xe(e),b=h.get(w);b&&(v.lines+=b.lines,v.columns+=b.columns);const k=g.get(n);k&&(v.lines+=k.lines,v.columns+=k.columns),h.set(w,v)}function Ee(e,t,n=!0){if(!n)return;if(!t.items.length)return;Ce({lines:0,columns:1},be(e),t);const l=B(t.items);Ce({lines:0,columns:1},xe(e),l)}function $e(e,t,n=!1){if(!n)return;if(!t.items.length)return;const l=B(t.items);l.comma=!0,Ce({lines:0,columns:1},xe(e),l)}function Se(e){const n=be(e),l=xe(e),o={lines:0,columns:{}};function r(e){e.loc.start.line+=o.lines,e.loc.start.column+=o.columns[e.loc.start.line]||0;const t=n.get(e);t&&(o.lines+=t.lines,o.columns[e.loc.start.line]=(o.columns[e.loc.start.line]||0)+t.columns)}function a(e){e.loc.end.line+=o.lines,e.loc.end.column+=o.columns[e.loc.end.line]||0;const t=l.get(e);t&&(o.lines+=t.lines,o.columns[e.loc.end.line]=(o.columns[e.loc.end.line]||0)+t.columns)}const c={enter:r,exit:a};he(e,{[t.Document]:c,[t.Table]:c,[t.TableArray]:c,[t.InlineTable]:c,[t.InlineArray]:c,[t.InlineItem]:c,[t.TableKey]:c,[t.TableArrayKey]:c,[t.KeyValue]:{enter(e){const t=e.loc.start.line+o.lines,n=l.get(e.key);e.equals+=(o.columns[t]||0)+(n?n.columns:0),r(e)},exit:a},[t.Key]:c,[t.String]:c,[t.Integer]:c,[t.Float]:c,[t.Boolean]:c,[t.DateTime]:c,[t.Comment]:c}),ge.delete(e),ke.delete(e)}function Ke(e,n,l={}){const{first_line_only:o=!1}=l,r=e.loc.start.line,{lines:a,columns:c}=n,i=e=>{o&&e.loc.start.line!==r||(e.loc.start.column+=c,e.loc.end.column+=c),e.loc.start.line+=a,e.loc.end.line+=a};return he(e,{[t.Table]:i,[t.TableKey]:i,[t.TableArray]:i,[t.TableArrayKey]:i,[t.KeyValue](e){i(e),e.equals+=c},[t.Key]:i,[t.String]:i,[t.Integer]:i,[t.Float]:i,[t.Boolean]:i,[t.DateTime]:i,[t.InlineArray]:i,[t.InlineItem]:i,[t.InlineTable]:i,[t.Comment]:i}),e}function Ce(e,t,n,l){const o=t.get(l||n);o&&(e.lines+=o.lines,e.columns+=o.columns),t.set(n,e)}function Oe(){return{type:t.Document,loc:{start:{line:1,column:0},end:{line:1,column:0}},items:[]}}function De(e){const n=function(e){const n=Fe(e);return{type:t.TableKey,loc:{start:{line:1,column:0},end:{line:1,column:n.length+2}},item:{type:t.Key,loc:{start:{line:1,column:1},end:{line:1,column:n.length+1}},value:e,raw:n}}}(e);return{type:t.Table,loc:g(n.loc),key:n,items:[]}}function je(e){const n=function(e){const n=Fe(e);return{type:t.TableArrayKey,loc:{start:{line:1,column:0},end:{line:1,column:n.length+4}},item:{type:t.Key,loc:{start:{line:1,column:2},end:{line:1,column:n.length+2}},value:e,raw:n}}}(e);return{type:t.TableArray,loc:g(n.loc),key:n,items:[]}}function Be(e,n){const l=function(e){const n=Fe(e);return{type:t.Key,loc:{start:{line:1,column:0},end:{line:1,column:n.length}},raw:n,value:e}}(e),{column:o}=l.loc.end,r=o+1;return Ke(n,{lines:0,columns:o+3-n.loc.start.column},{first_line_only:!0}),{type:t.KeyValue,loc:{start:h(l.loc.start),end:h(n.loc.end)},key:l,equals:r,value:n}}const _e=/[\w,\d,\_,\-]+/;function Fe(e){return e.map(e=>_e.test(e)?e:JSON.stringify(e)).join(".")}function Me(e){return{type:t.InlineItem,loc:g(e.loc),item:e,comma:!1}}function Ne(e){return e.items.filter(e=>{if(!a(e))return!1;const t=u(e.value),n=c(e.value)&&e.value.items.length&&u(e.value.items[0].item);return t||n}).forEach(t=>{Ae(e,e,t),u(t.value)?Ie(e,e,function(e){const t=De(e.key.value);for(const n of e.value.items)Ie(t,t,n.item);return Se(t),t}(t)):function(e){const t=Oe();for(const n of e.value.items){const l=je(e.key.value);Ie(t,t,l);for(const e of n.item.items)Ie(t,l,e.item)}return Se(t),t.items}(t).forEach(t=>{Ie(e,e,t)})}),Se(e),e}function Le(e){let t=0,n=0;for(const l of e.items)0===n&&l.loc.start.line>1?t=1-l.loc.start.line:l.loc.start.line+t>n+2&&(t+=n+2-(l.loc.start.line+t)),Ke(l,{lines:t,columns:0}),n=l.loc.end.line;return e}const Ue={printWidth:80,trailingComma:!1,bracketSpacing:!0};function Ve(e,t={}){t=Object.assign({},Ue,t),e=We(e);const n=Oe();for(const l of qe(e,t))Ie(n,n,l);return Se(n),U(n,Ne,e=>(function(e,t){return e})(e),Le)}function*qe(e,t){for(const n of Object.keys(e))yield Be([n],Re(e[n],t))}function Re(e,n){if(null==e)throw new Error('"null" and "undefined" values are not supported');return function(e){return"string"==typeof e}(e)?function(e){const n=JSON.stringify(e);return{type:t.String,loc:{start:{line:1,column:0},end:{line:1,column:n.length}},raw:n,value:e}}(e):F(e)?function(e){const n=e.toString();return{type:t.Integer,loc:{start:{line:1,column:0},end:{line:1,column:n.length}},raw:n,value:e}}(e):function(e){return"number"==typeof e&&!F(e)}(e)?function(e){const n=e.toString();return{type:t.Float,loc:{start:{line:1,column:0},end:{line:1,column:n.length}},raw:n,value:e}}(e):function(e){return"boolean"==typeof e}(e)?function(e){return{type:t.Boolean,loc:{start:{line:1,column:0},end:{line:1,column:e?4:5}},value:e}}(e):M(e)?function(e){const n=e.toISOString();return{type:t.DateTime,loc:{start:{line:1,column:0},end:{line:1,column:n.length}},raw:n,value:e}}(e):Array.isArray(e)?function(e,n){const l={type:t.InlineArray,loc:{start:{line:1,column:0},end:{line:1,column:2}},items:[]};for(const t of e){const e=Re(t,n),o=Me(e);Ie(l,l,o)}return Ee(l,l,n.bracketSpacing),$e(l,l,n.trailingComma),Se(l),l}(e,n):function(e,n){if(!N(e=We(e)))return Re(e,n);const l={type:t.InlineTable,loc:{start:{line:1,column:0},end:{line:1,column:2}},items:[]},o=[...qe(e,n)];for(const e of o){const t=Me(e);Ie(l,l,t)}return Ee(l,l,n.bracketSpacing),$e(l,l,n.trailingComma),Se(l),l}(e,n)}function We(e){return e&&!M(e)&&"function"==typeof e.toJSON?e.toJSON():e}const Je=/(\r\n|\n)/g;function Pe(e,n="\n"){const l=[];return he(e,{[t.TableKey](e){const{start:t,end:n}=e.loc;ze(l,{start:t,end:{line:t.line,column:t.column+1}},"["),ze(l,{start:{line:n.line,column:n.column-1},end:n},"]")},[t.TableArrayKey](e){const{start:t,end:n}=e.loc;ze(l,{start:t,end:{line:t.line,column:t.column+2}},"[["),ze(l,{start:{line:n.line,column:n.column-2},end:n},"]]")},[t.KeyValue](e){const{start:{line:t}}=e.loc;ze(l,{start:{line:t,column:e.equals},end:{line:t,column:e.equals+1}},"=")},[t.Key](e){ze(l,e.loc,e.raw)},[t.String](e){ze(l,e.loc,e.raw)},[t.Integer](e){ze(l,e.loc,e.raw)},[t.Float](e){ze(l,e.loc,e.raw)},[t.Boolean](e){ze(l,e.loc,e.value.toString())},[t.DateTime](e){ze(l,e.loc,e.raw)},[t.InlineArray](e){const{start:t,end:n}=e.loc;ze(l,{start:t,end:{line:t.line,column:t.column+1}},"["),ze(l,{start:{line:n.line,column:n.column-1},end:n},"]")},[t.InlineTable](e){const{start:t,end:n}=e.loc;ze(l,{start:t,end:{line:t.line,column:t.column+1}},"{"),ze(l,{start:{line:n.line,column:n.column-1},end:n},"}")},[t.InlineItem](e){if(!e.comma)return;const t=e.loc.end;ze(l,{start:t,end:{line:t.line,column:t.column+1}},",")},[t.Comment](e){ze(l,e.loc,e.raw)}}),l.join(n)+n}function ze(e,t,n){const l=n.split(Je),o=t.end.line-t.start.line+1;if(l.length!==o)throw new Error(`Mismatch between location and raw string, expected ${o} lines for "${n}"`);for(let n=t.start.line;n<=t.end.line;n++){const o=He(e,n),r=n===t.start.line,a=n===t.end.line,c=r?o.substr(0,t.start.column).padEnd(t.start.column,A):"",i=a?o.substr(t.end.column):"";e[n-1]=c+l[n-t.start.line]+i}}function He(e,t){if(!e[t-1])for(let n=0;n<t;n++)e[n]||(e[n]="");return e[t-1]}function Ge(e,n=""){const l=_(),o=new Set,r=new Set,a=new Set;let c,i=l,s=!1;return he(e,{[t.Table](e){const t=e.key.item.value;try{Qe(l,t,e.type,{tables:o,table_arrays:r,defined:a})}catch(t){throw new b(n,e.key.loc.start,t.message)}const c=Ze(t);o.add(c),a.add(c),i=Xe(l,t)},[t.TableArray](e){const t=e.key.item.value;try{Qe(l,t,e.type,{tables:o,table_arrays:r,defined:a})}catch(t){throw new b(n,e.key.loc.start,t.message)}const c=Ze(t);r.add(c),a.add(c),i=function(e,t){const n=Ye(e,t.slice(0,-1)),l=B(t);n[l]||(n[l]=[]);const o=_();return n[B(t)].push(o),o}(l,t)},[t.KeyValue]:{enter(e){if(s)return;const l=e.key.value;try{Qe(i,l,e.type,{tables:o,table_arrays:r,defined:a})}catch(t){throw new b(n,e.key.loc.start,t.message)}const f=function e(n){switch(n.type){case t.InlineTable:const l=_();return n.items.forEach(({item:t})=>{const n=t.key.value,o=e(t.value),r=n.length>1?Xe(l,n.slice(0,-1)):l;r[B(n)]=o}),l;case t.InlineArray:return n.items.map(t=>e(t.item));case t.String:case t.Integer:case t.Float:case t.Boolean:case t.DateTime:return n.value;default:throw new Error(`Unrecognized value type "${n.type}"`)}}(e.value);(l.length>1?Xe(i,l.slice(0,-1)):i)[B(l)]=f,a.add(Ze(l)),u(e.value)&&(c=i,i=f)},exit(e){u(e.value)&&(i=c)}},[t.InlineTable]:{enter(){s=!0},exit(){s=!1}}}),l}function Qe(e,n,l,o){let r=[],a=0;for(const t of n){if(r.push(t),!L(e,t))return;if("object"!=typeof(c=e[t])&&!M(c))throw new Error(`Invalid key, a value has already been defined for ${r.join(".")}`);const l=Ze(r);if(Array.isArray(e[t])&&!o.table_arrays.has(l))throw new Error(`Invalid key, cannot add to a static array at ${l}`);const i=a++<n.length-1;e=Array.isArray(e[t])&&i?B(e[t]):e[t]}var c;const i=Ze(n);if(e&&l===t.Table&&o.defined.has(i))throw new Error(`Invalid key, a table has already been defined named ${i}`);if(e&&l===t.TableArray&&!o.table_arrays.has(i))throw new Error(`Invalid key, cannot add an array of tables to a table at ${i}`)}function Xe(e,t){const n=Ye(e,t.slice(0,-1)),l=B(t);return n[l]||(n[l]=_()),n[l]}function Ye(e,t){return t.reduce((e,t)=>(e[t]||(e[t]=_()),Array.isArray(e[t])?B(e[t]):e[t]),e)}function Ze(e){return e.join(".")}var et;function tt(e,t,n=[]){return e===t||(o=t,M(l=e)&&M(o)&&l.toISOString()===o.toISOString())?[]:Array.isArray(e)&&Array.isArray(t)?function(e,t,n=[]){let l=[];const o=e.map(V),r=t.map(V);r.forEach((a,c)=>{const i=c>=o.length;if(!i&&o[c]===a)return;const u=o.indexOf(a,c+1);if(!i&&u>-1){l.push({type:et.Move,path:n,from:u,to:c});const e=o.splice(u,1);return void o.splice(c,0,...e)}const s=!r.includes(o[c]);if(!i&&s)return q(l,tt(e[c],t[c],n.concat(c))),void(o[c]=a);l.push({type:et.Add,path:n.concat(c)}),o.splice(c,0,a)});for(let e=r.length;e<o.length;e++)l.push({type:et.Remove,path:n.concat(e)});return l}(e,t,n):N(e)&&N(t)?function(e,t,n=[]){let l=[];const o=Object.keys(e),r=o.map(t=>V(e[t])),a=Object.keys(t),c=a.map(e=>V(t[e])),i=(e,t)=>{const n=t.indexOf(e);if(n<0)return!1;const l=o[r.indexOf(e)];return!a.includes(l)};return o.forEach((o,u)=>{const s=n.concat(o);if(a.includes(o))q(l,tt(e[o],t[o],s));else if(i(r[u],c)){const e=a[c.indexOf(r[u])];l.push({type:et.Rename,path:n,from:o,to:e})}else l.push({type:et.Remove,path:s})}),a.forEach((e,t)=>{o.includes(e)||i(c[t],r)||l.push({type:et.Add,path:n.concat(e)})}),l}(e,t,n):[{type:et.Edit,path:n}];var l,o}function nt(e,t){if(!t.length)return e;if(a(e))return nt(e.value,t);const n={};let l;if(f(e)&&e.items.some((e,c)=>{try{let u=[];if(a(e))u=e.key.value;else if(o(e))u=e.key.item.value;else if(r(e)){const t=V(u=e.key.item.value);n[t]||(n[t]=0);const l=n[t]++;u=u.concat(l)}else i(e)&&a(e.item)?u=e.item.key.value:i(e)&&(u=[c]);return!(!u.length||!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(u,t.slice(0,u.length)))&&(l=nt(e,t.slice(u.length)),!0)}catch(e){return!1}}),!l)throw new Error(`Could not find node at path ${t.join(".")}`);return l}function lt(e,t){try{return nt(e,t)}catch(e){}}function ot(e,t){let n,l=t;for(;l.length&&!n;)n=lt(e,l=l.slice(0,-1));if(!n)throw new Error(`Count not find parent node for path ${t.join(".")}`);return n}!function(e){e.Add="Add",e.Edit="Edit",e.Remove="Remove",e.Move="Move",e.Rename="Rename"}(et||(et={})),e.parse=function(e){return Ge(ye(e),e)},e.patch=function(e,n,i){const u=[...ye(e)],s=Ge(u);return Pe(function(e,t,n){return n.forEach(n=>{if(function(e){return e.type===et.Add}(n)){const i=nt(t,n.path),u=n.path.slice(0,-1);let s,f=B(n.path),m=r(i);if(F(f)&&!u.some(F)){const t=lt(e,u.concat(0));t&&r(t)&&(m=!0)}if(o(i))s=e;else if(m){s=e;const t=e,n=lt(t,u.concat(f-1)),l=lt(t,u.concat(f));f=l?t.items.indexOf(l):n?t.items.indexOf(n)+1:t.items.length}else a(s=ot(e,n.path))&&(s=s.value);r(s)||c(s)||l(s)?Ie(e,s,i,f):Ie(e,s,i)}else if(function(e){return e.type===et.Edit}(n)){let l,o=nt(e,n.path),r=nt(t,n.path);a(o)&&a(r)?(l=o,o=o.value,r=r.value):l=ot(e,n.path),Te(e,l,o,r)}else if(function(e){return e.type===et.Remove}(n)){let t=ot(e,n.path);a(t)&&(t=t.value);const l=nt(e,n.path);Ae(e,t,l)}else if(function(e){return e.type===et.Move}(n)){let t=nt(e,n.path);m(t)&&(t=t.item),a(t)&&(t=t.value);const l=t.items[n.from];Ae(e,t,l),Ie(e,t,l,n.to)}else if(function(e){return e.type===et.Rename}(n)){let l=nt(e,n.path.concat(n.from)),o=nt(t,n.path.concat(n.to));m(l)&&(l=l.item),m(o)&&(o=o.item),Te(e,l,l.key,o.key)}}),Se(e),e}({type:t.Document,loc:{start:{line:1,column:0},end:{line:1,column:0}},items:u},Ve(n,i),tt(s,n)).items)},e.stringify=function(e,t){return Pe(Ve(e,t).items)},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=toml-patch.umd.min.js.map
